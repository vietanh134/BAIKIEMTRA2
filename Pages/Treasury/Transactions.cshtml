@page
@model PCMSystem.Pages.Treasury.TransactionsModel

@{
    ViewData["Title"] = "Qu·∫£n l√Ω giao d·ªãch";
}

<div class="container mt-5">
    <h1 class="mb-4">üí∞ Qu·∫£n l√Ω Giao d·ªãch T√†i ch√≠nh</h1>

    <!-- Alert c·∫£nh b√°o qu·ªπ √¢m -->
    @if (Model.CurrentBalance < 0)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>‚ö†Ô∏è C·∫¢NH B√ÅO: QU·ª∏ ƒêANG √ÇM!</strong> C·∫ßn b·ªï sung ngu·ªìn ti·ªÅn ngay. S·ªë d∆∞: 
            <span class="text-danger font-weight-bold">@Model.CurrentBalance.ToString("C0")</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- T·ªïng qu·ªπ hi·ªán t·∫°i -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-center shadow animate__animated card-hover-gradient treasury-card" tabindex="0">
                <div class="card-body">
                    <h6 class="text-muted">T·ªïng Qu·ªπ Hi·ªán T·∫°i</h6>
                    <h2 class="@(Model.CurrentBalance >= 0 ? "text-success" : "text-danger")">
                        @Model.CurrentBalance.ToString("C0")
                    </h2>
                </div>
            </div>
        </div>
    </div>

    <!-- N√∫t th√™m giao d·ªãch -->
    <div class="mb-3">
        <a asp-page="./CreateTransaction" class="btn btn-success">+ Th√™m giao d·ªãch</a>
        <a asp-page="./Categories" class="btn btn-info">‚öôÔ∏è Qu·∫£n l√Ω Danh m·ª•c</a>
        <a href="/api/treasury/export-transactions" class="btn btn-warning">üìä Xu·∫•t Excel</a>
    </div>

    <!-- Danh s√°ch giao d·ªãch -->
    <div class="card shadow animate__animated card-hover-gradient treasury-card" tabindex="0">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">L·ªãch s·ª≠ giao d·ªãch</h5>
        </div>
        <div class="card-body">
            @if (Model.Transactions.Count > 0)
            {
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Ng√†y</th>
                                <th>Danh m·ª•c</th>
                                <th>Lo·∫°i</th>
                                <th class="text-end">S·ªë ti·ªÅn</th>
                                <th>M√¥ t·∫£</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var transaction in Model.Transactions)
                            {
                                <tr>
                                    <td>@transaction.TransactionDate.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td><span class="badge bg-info">@transaction.Category.CategoryName</span></td>
                                    <td>
                                        @if (transaction.Category.Type == "Thu")
                                        {
                                            <span class="badge bg-success">Thu</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger">Chi</span>
                                        }
                                    </td>
                                    <td class="text-end @(transaction.Category.Type == "Thu" ? "text-success" : "text-danger") font-weight-bold">
                                        @(transaction.Category.Type == "Thu" ? "+" : "-")@transaction.Amount.ToString("C0")
                                    </td>
                                    <td>@transaction.Description</td>
                                    <td>
                                        <form method="post" asp-page-handler="delete" style="display: inline;">
                                            <input type="hidden" name="id" value="@transaction.Id"/>
                                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('X√≥a giao d·ªãch n√†y?');">
                                                üóëÔ∏è
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info">Ch∆∞a c√≥ giao d·ªãch n√†o.</div>
            }
        </div>
    </div>
</div>
