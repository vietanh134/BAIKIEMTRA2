@page
@model PCMSystem.Pages.Matches.CreateModel

@{
    ViewData["Title"] = "Ghi nh·∫≠n Tr·∫≠n ƒë·∫•u";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h1 class="mb-4">üìù Ghi nh·∫≠n Tr·∫≠n ƒë·∫•u m·ªõi</h1>

            @if (!string.IsNullOrEmpty(Model.ErrorMessage))
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    @Model.ErrorMessage
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <div class="card shadow animate__animated card-hover-gradient match-card" tabindex="0">
                <div class="card-body">
                    <form method="post">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="ChallengeId" class="form-label">Ch·ªçn K√®o (T√πy ch·ªçn)</label>
                                <select name="ChallengeId" id="ChallengeId" class="form-select">
                                    <option value="">-- Tr·∫≠n giao h·ªØu --</option>
                                    @foreach (var challenge in Model.Challenges)
                                    {
                                        <option value="@challenge.Id">@challenge.Title</option>
                                    }
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="Format" class="form-label">Th·ªÉ th·ª©c</label>
                                <select name="Format" id="Format" class="form-select" required onchange="updatePlayers()">
                                    <option value="">-- Ch·ªçn th·ªÉ th·ª©c --</option>
                                    <option value="0">ƒê∆°n (1vs1)</option>
                                    <option value="1">ƒê√¥i (2vs2)</option>
                                </select>
                            </div>
                        </div>

                        <hr/>

                        <h5 class="mb-3">Ng∆∞·ªùi Th·∫Øng</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="Winner1Id" class="form-label">Ng∆∞·ªùi Th·∫Øng 1</label>
                                <select name="Winner1Id" id="Winner1Id" class="form-select" required>
                                    <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                                    @foreach (var member in Model.Members)
                                    {
                                        <option value="@member.Id">@member.FullName</option>
                                    }
                                </select>
                            </div>

                            <div class="col-md-6 mb-3" id="winner2Section" style="display: none;">
                                <label for="Winner2Id" class="form-label">Ng∆∞·ªùi Th·∫Øng 2</label>
                                <select name="Winner2Id" id="Winner2Id" class="form-select">
                                    <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                                    @foreach (var member in Model.Members)
                                    {
                                        <option value="@member.Id">@member.FullName</option>
                                    }
                                </select>
                            </div>
                        </div>

                        <hr/>

                        <h5 class="mb-3">Ng∆∞·ªùi Thua</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="Loser1Id" class="form-label">Ng∆∞·ªùi Thua 1</label>
                                <select name="Loser1Id" id="Loser1Id" class="form-select" required>
                                    <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                                    @foreach (var member in Model.Members)
                                    {
                                        <option value="@member.Id">@member.FullName</option>
                                    }
                                </select>
                            </div>

                            <div class="col-md-6 mb-3" id="loser2Section" style="display: none;">
                                <label for="Loser2Id" class="form-label">Ng∆∞·ªùi Thua 2</label>
                                <select name="Loser2Id" id="Loser2Id" class="form-select">
                                    <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                                    @foreach (var member in Model.Members)
                                    {
                                        <option value="@member.Id">@member.FullName</option>
                                    }
                                </select>
                            </div>
                        </div>

                        <hr/>

                        <div class="mb-3">
                            <div class="form-check">
                                <input type="checkbox" name="IsRanked" id="IsRanked" class="form-check-input" value="true"/>
                                <label class="form-check-label" for="IsRanked">
                                    ‚úì T√≠nh v√†o Rank DUPR
                                    <small class="text-muted">(Ng∆∞·ªùi th·∫Øng +0.1, Ng∆∞·ªùi thua -0.1)</small>
                                </label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="Notes" class="form-label">Ghi ch√∫ (T√πy ch·ªçn)</label>
                            <textarea name="Notes" id="Notes" class="form-control" rows="2"></textarea>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-success flex-grow-1">‚úÖ L∆∞u k·∫øt qu·∫£</button>
                            <a asp-page="./Index" class="btn btn-secondary">H·ªßy</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function updatePlayers() {
        const format = document.getElementById('Match_Format').value;
        const winner2Section = document.getElementById('winner2Section');
        const loser2Section = document.getElementById('loser2Section');
        const winner2Select = document.querySelector('[name="Match.Winner2Id"]');
        const loser2Select = document.querySelector('[name="Match.Loser2Id"]');

        if (format === '1') { // Doubles
            winner2Section.style.display = 'block';
            loser2Section.style.display = 'block';
            winner2Select.required = true;
            loser2Select.required = true;
        } else {
            winner2Section.style.display = 'none';
            loser2Section.style.display = 'none';
            winner2Select.required = false;
            loser2Select.required = false;
        }
    }
</script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
